# 测试统计 - 03-07 统计

## 46 node-1
|复现时间|复现时长/min|该时间段最高负载|
|--|--|--|
|01:31-01:32|1|100+|
|02:15-02:16|1|200+|
|02:31-02:33|2|250+|
|02:47-03-48|1|300+|
|03:03-03-05|2|300+|
|03:19-03-30 |11|2000+|

* 当日总次数: 6
* 当日总时长: 18 min

## node-2:
|复现时间|复现时长/min|该时间段最高负载|
|--|--|--|
|03:29-03-35|6|1000+|
|03:51-03-53|2|550+|
|04:29-04:32|3|1200+|
|05:46-05:49|3|800+|
|06:28-06:29|1|200+|
|06:30-06-32|2|250+|
|07:53-07:57|4|1000+|



* 当日总次数:7
* 当日总时长:21 min
## node-3:
无

# 51环境
## node-1
无
## node-2
无
## node-3

|复现时间|复现时长/min|该时间段最高负载|
|--|--|--|
|23:20-23:23|3|700+|
|00:03-00:05|2|400+|
|00:34-00:38|4|1400+|
|02:53-02:57|4|1600+|
|07:59-08:01|2|400+|
|08:44-08:47|3|600+|

* 当日总次数: 6
* 当日总时长: 18 min

# 51环境调整 - 03-07 17:55
将drop_cache.sh定时任务加上


# 测试统计 - 03-08 统计

## node-1
|复现时间|复现时长/min|该时间段最高负载|
|--|--|--|
|05:09-05:11|3|450+|

# node-2
|复现时间|复现时长/min|该时间段最高负载|
|--|--|--|
|08:37-08:41|4|1350+|

# node-3
|复现时间|复现时长/min|该时间段最高负载|
|--|--|--|
|23:07-23:10|3|600+|
|00:08-12:12|4|1150+|
|08:20-08:23|3|850+|

# 46环境调整  - 03-07 21:57
替换kernel (增加trace event code).
在高负载时统计0-16核的调度event



# 测试统计 - 03 -11
## 51环境
### node-2
|复现时间|复现时长/min|该时间段最高负载|
|--|--|--|
|03-09 20:27-08:29|2|300+|
|03-09 22:00-10:02|2|350+|

## node-3
|复现时间|复现时长/min|该时间段最高负载|
|--|--|--|
|03-08 22:07-22:10|3|600+|
|03-09 14:41-15:42|1|200+|
|03-09 15:09-15:12|3|400+|
|03-09 16:19-16:22|3|500+|
|03-09 17:03-17:05|2|300+|
|03-09 19:08-19:09|1|200+|
|03-09 20:24-20:26|2|800+|
|03-09 22:05-22:08|3|600+|

## 46 环境
该环境自动化测试停止,未复现


# 46环境调整 - 03-11 20:49
替换kernel, 除去调度event(日志太乱)

# 49 环境调整 - 03-14 21:00
替换kernel, 优化`expand_one_shrinker_info`, 目前看起来良好


# 测试统计 - 03-18 21:14 -- 03-20 10:11
## 51 环境
### node-1
|复现时间|复现时长|该时间段最高负载|
|--|--|--|
|03-19 23:24:58 - 23:25:03|10s-|100+|
> NOTE
>
> 这个也不算复现, 持续时间太短

### node-2
无

### node-3
|复现时间|复现时长/min|该时间段最高负载|
|--|--|--|
|03-19 15:54:25-15:54:37|30s-|103|
|03-19 16:22:23-16:22:55|30s+|143|
|03-19 19:00:51-19:01:29|40s+|143|
|03-20 11:20:44-11:26:32|6m|430|


### 该环境其他信息
我们在该环境中发现有一定的系统负载:

```
top - 11:04:47 up 5 days, 8 min,  2 users,  load average: 33.93, 32.24, 29.02
Tasks: 4312 total,  17 running, 4292 sleeping,   0 stopped,   3 zombie
%Cpu0  : 17.6 us, 20.1 sy,  0.0 ni, 57.1 id,  0.0 wa,  0.0 hi,  5.2 si,  0.0 st
%Cpu1  : 18.6 us, 15.0 sy,  0.0 ni, 63.6 id,  0.4 wa,  0.0 hi,  2.5 si,  0.0 st
%Cpu2  : 17.1 us, 15.4 sy,  0.0 ni, 63.8 id,  0.3 wa,  0.0 hi,  3.4 si,  0.0 st
%Cpu3  : 20.0 us,  9.5 sy,  0.0 ni, 63.2 id,  0.4 wa,  0.0 hi,  7.0 si,  0.0 st
%Cpu4  : 22.3 us, 21.9 sy,  0.0 ni, 50.2 id,  0.0 wa,  0.0 hi,  5.6 si,  0.0 st
%Cpu5  : 21.2 us, 14.8 sy,  0.0 ni, 59.0 id,  0.7 wa,  0.0 hi,  4.2 si,  0.0 st
%Cpu6  : 20.6 us, 23.6 sy,  0.0 ni, 48.5 id,  0.3 wa,  0.0 hi,  7.0 si,  0.0 st
%Cpu7  : 14.3 us, 25.3 sy,  0.0 ni, 50.3 id,  0.3 wa,  0.0 hi,  9.7 si,  0.0 st
%Cpu8  : 22.4 us, 13.1 sy,  0.0 ni, 62.4 id,  1.0 wa,  0.0 hi,  1.0 si,  0.0 st
%Cpu9  : 15.9 us, 31.8 sy,  0.0 ni, 51.0 id,  0.3 wa,  0.0 hi,  1.0 si,  0.0 st
%Cpu10 : 21.6 us, 12.8 sy,  0.0 ni, 63.5 id,  1.4 wa,  0.0 hi,  0.7 si,  0.0 st
%Cpu11 : 15.8 us, 13.1 sy,  0.0 ni, 69.4 id,  1.0 wa,  0.0 hi,  0.7 si,  0.0 st
%Cpu12 : 19.4 us, 20.8 sy,  0.0 ni, 59.2 id,  0.0 wa,  0.0 hi,  0.7 si,  0.0 st
%Cpu13 : 27.4 us, 10.3 sy,  0.0 ni, 61.0 id,  0.7 wa,  0.0 hi,  0.7 si,  0.0 st
%Cpu14 : 13.1 us, 23.2 sy,  0.0 ni, 63.0 id,  0.3 wa,  0.0 hi,  0.3 si,  0.0 st
%Cpu15 : 18.4 us, 15.3 sy,  0.0 ni, 65.0 id,  0.7 wa,  0.0 hi,  0.7 si,  0.0 st
```

perf top 进行统计时, 发现在收包.
```
+   28.65%     0.01%  [kernel]                                    [k] el0_svc
+   28.53%     0.81%  [kernel]                                    [k] el0_svc_handler
+   24.81%     0.00%  libc-2.27.so                                [.] 0x0000ffff836204ec
+   24.81%     0.00%  libpthread-2.27.so                          [.] 0x0000ffff836b7088
+   24.81%     0.00%  beam.smp                                    [.] 0x0000aaaac3cbb780
+   21.35%     0.00%  [kernel]                                    [k] cpu_startup_entry
+   21.33%     0.16%  [kernel]                                    [k] do_idle
+   20.33%     0.00%  beam.smp                                    [.] 0x0000aaaac3a2f1e4
+   19.95%     3.59%  [kernel]                                    [k] __schedule
+   19.37%     0.00%  [kernel]                                    [k] secondary_start_kernel
+   19.21%     2.21%  [kernel]                                    [k] __softirqentry_text_start
+   16.90%     0.00%  beam.smp                                    [.] 0x0000aaaac3a37e64
+   16.16%    14.49%  [kernel]                                    [k] finish_task_switch
+   15.37%     0.00%  [kernel]                                    [k] gic_handle_irq
+   15.37%     0.00%  [kernel]                                    [k] irq_exit
+   15.37%     0.00%  [kernel]                                    [k] irq_exit_rcu
+   14.93%     0.00%  [kernel]                                    [k] __handle_domain_irq
+   14.42%     0.05%  [kernel]                                    [k] net_rx_action
+   14.33%     0.00%  [kernel]                                    [k] __napi_poll
+   12.77%     0.00%  [kernel]                                    [k] el1_irq
```

向彬彬, 继德请教, 发现该环境在做网络测试, 不知道该行为对高负载会不会有影响.

> NOTE
>
> 暂时的结论:
>
> 经这两天测试, 看起来高负载有所缓解. 因为目前的 es8_9 kernel 并没有合入优化`shrink_slab`性能
> 的patch. 需要进一步测试验证合入该patch后,高负载问题 会不会长时间不复现.
