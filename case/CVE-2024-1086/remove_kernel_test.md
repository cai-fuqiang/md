# arm64/x86_64 

> NOTE
>
> 由于两者逻辑一样, 每个环境之测试一个架构

## 611升级621环境
环境信息
```
[root@localhost 147_24]# uname -r
4.18.0-372.19.1.es8_10.aarch64
[root@localhost 147_24]# ls /boot |grep vmlinuz-|grep -v rescue
vmlinuz-4.18.0-147.5.1.es8_24.aarch64
vmlinuz-4.18.0-372.19.1.es8_10.aarch64
[root@localhost 147_24]# rpm -qa |grep kernel-core
kernel-core-4.18.0-372.19.1.es8_10.aarch64
kernel-core-4.18.0-147.5.1.es8_24.aarch64
```

执行脚本:
```
[root@localhost 147_24]# sh /root/remove_kernel.sh
delete kdump initrd
the number of kernel is 2, need remove to keep number to 1
remove kernel 4.18.0-147.5.1.es8_24.aarch64
=== 4.18.0-147.5.1.es8_24.aarch64
KVER is 4.18.0-147.5.1.es8_24.aarch64, remove rpm package kernel-core-4.18.0-147.5.1.es8_24.aarch64
Dependencies resolved.
==========================================================================================================================================================================================================================
 Package                                                   Architecture                                 Version                                                       Repository                                     Size
==========================================================================================================================================================================================================================
Removing:
 kernel-core                                               aarch64                                      4.18.0-147.5.1.es8_24                                         @@System                                       55 M
Removing dependent packages:
 kernel                                                    aarch64                                      4.18.0-147.5.1.es8_24                                         @@System                                        0
 kernel-modules                                            aarch64                                      4.18.0-147.5.1.es8_24                                         @@System                                      7.6 M
 kernel-modules-extra                                      aarch64                                      4.18.0-147.5.1.es8_24                                         @@System                                      432 k

Transaction Summary
==========================================================================================================================================================================================================================
Remove  4 Packages

Freed space: 63 M
Running transaction check
Transaction check succeeded.
Running transaction test
Transaction test succeeded.
Running transaction
  Preparing        :                                                                                                                                                                                                  1/1
  Erasing          : kernel-4.18.0-147.5.1.es8_24.aarch64                                                                                                                                                             1/4
  Running scriptlet: kernel-4.18.0-147.5.1.es8_24.aarch64                                                                                                                                                             1/4
  Erasing          : kernel-modules-extra-4.18.0-147.5.1.es8_24.aarch64                                                                                                                                               2/4
  Running scriptlet: kernel-modules-extra-4.18.0-147.5.1.es8_24.aarch64                                                                                                                                               2/4
  Erasing          : kernel-modules-4.18.0-147.5.1.es8_24.aarch64                                                                                                                                                     3/4
  Running scriptlet: kernel-modules-4.18.0-147.5.1.es8_24.aarch64                                                                                                                                                     3/4
  Running scriptlet: kernel-core-4.18.0-147.5.1.es8_24.aarch64                                                                                                                                                        4/4
  Erasing          : kernel-core-4.18.0-147.5.1.es8_24.aarch64                                                                                                                                                        4/4
  Running scriptlet: kernel-core-4.18.0-147.5.1.es8_24.aarch64                                                                                                                                                        4/4
  Verifying        : kernel-4.18.0-147.5.1.es8_24.aarch64                                                                                                                                                             1/4
  Verifying        : kernel-core-4.18.0-147.5.1.es8_24.aarch64                                                                                                                                                        2/4
  Verifying        : kernel-modules-4.18.0-147.5.1.es8_24.aarch64                                                                                                                                                     3/4
  Verifying        : kernel-modules-extra-4.18.0-147.5.1.es8_24.aarch64                                                                                                                                               4/4

Removed:
  kernel-4.18.0-147.5.1.es8_24.aarch64           kernel-core-4.18.0-147.5.1.es8_24.aarch64           kernel-modules-4.18.0-147.5.1.es8_24.aarch64           kernel-modules-extra-4.18.0-147.5.1.es8_24.aarch64

Complete!
remove rpm pkg kernel-core-4.18.0-147.5.1.es8_24.aarch64 success
```

## 601升级611
由于无法构建出环境, 只是手动创建vmlinuz 和initramfs
环境信息
```
[root@localhost ~]# uname -r
4.18.0-147.5.1.es8_24.aarch64
[root@localhost ~]# ls /boot/vmlinuz-*|grep -v rescue
/boot/vmlinuz-4.18.0-147.5.1.el8_1.5es.14.aarch64
/boot/vmlinuz-4.18.0-147.5.1.es8_24.aarch64
```

执行脚本
```
[root@localhost ~]# sh /root/remove_kernel.sh
delete kdump initrd
the number of kernel is 2, need remove to keep number to 1
remove kernel 4.18.0-147.5.1.el8_1.5es.14.aarch64
direct remove kernel 4.18.0-147.5.1.el8_1.5es.14.aarch64 to /root/escloud_image_backup/4.18.0-147.5.1.el8_1.5es.14.aarch64
[root@localhost ~]# ls /root/escloud_image_backup/4.18.0-147.5.1.el8_1.5es.14.aarch64/
initramfs-4.18.0-147.5.1.el8_1.5es.14.aarch64.img  vmlinuz-4.18.0-147.5.1.el8_1.5es.14.aarch64
```

## v5 升级 601
环境信息
```
[root@node-1 wangfuqiang]# rpm -qa |grep -E 'kernel-3.10|kernel-core'
warning: Macro %el6 needs whitespace before body
kernel-core-4.18.0-147.5.1.el8_1.5es.14.x86_64
kernel-3.10.0-693.11.1.el7.es.9.x86_64
[root@node-1 wangfuqiang]# ls /boot/vmlinuz-* |grep -v rescue
-rwxr-xr-x  1 root 5880944 Jun 14  2018 /boot/vmlinuz-3.10.0-693.11.1.el7.es.9.x86_64
-rwxr-xr-x. 1 root 8111232 Jan 29  2021 /boot/vmlinuz-4.18.0-147.5.1.el8_1.5es.14.x86_64
```
执行脚本:
```
[root@node-1 wangfuqiang]# sh remove_kernel.sh
delete kdump initrd
the number of kernel is 2, need remove to keep number to 1
remove kernel 3.10.0-693.11.1.el7.es.9.x86_64
KVER is 3.10.0-693.11.1.el7.es.9.x86_64, remove rpm package kernel-3.10.0-693.11.1.el7.es.9.x86_64
warning: Macro %el6 needs whitespace before body
Loaded plugins: fastestmirror
Resolving Dependencies
--> Running transaction check
---> Package kernel.x86_64 0:3.10.0-693.11.1.el7.es.9 will be erased
--> Finished Dependency Resolution

Dependencies Resolved

================================================================================================================================================================================================================
 Package                                      Arch                                         Version                                                        Repository                                       Size
================================================================================================================================================================================================================
Removing:
 kernel                                       x86_64                                       3.10.0-693.11.1.el7.es.9                                       installed                                        60 M

Transaction Summary
================================================================================================================================================================================================================
Remove  1 Package

Installed size: 60 M
Downloading packages:
Running transaction check
Running transaction test
Transaction test succeeded
Running transaction
Warning: RPMDB altered outside of yum.
  Erasing    : kernel-3.10.0-693.11.1.el7.es.9.x86_64                                                                                                                                                       1/1
  Verifying  : kernel-3.10.0-693.11.1.el7.es.9.x86_64                                                                                                                                                       1/1

Removed:
  kernel.x86_64 0:3.10.0-693.11.1.el7.es.9

Complete!
remove rpm pkg kernel-3.10.0-693.11.1.el7.es.9.x86_64 success
```

# s2500

## 611升级621
环境信息
```
[root@localhost ~]# rpm -qa |grep kernel-numa64-core
kernel-numa64-core-4.18.0-372.19.1.es8_10.aarch64
kernel-numa64-core-4.18.0-147.5.1.es8_24.aarch64
[root@localhost ~]# ls /boot/vmlinuz-* |grep -v rescue
/boot/vmlinuz-4.18.0-147.5.1.es8_24.aarch64+numa64
/boot/vmlinuz-4.18.0-372.19.1.es8_10.aarch64+numa64
```

执行脚本:
```
[root@localhost ~]# sh remove_kernel.sh
delete kdump initrd
the number of kernel is 2, need remove to keep number to 1
remove kernel 4.18.0-147.5.1.es8_24.aarch64+numa64
=== 4.18.0-147.5.1.es8_24.aarch64+numa64
KVER is 4.18.0-147.5.1.es8_24.aarch64+numa64, remove rpm package kernel-numa64-core-4.18.0-147.5.1.es8_24.aarch64
Dependencies resolved.
======================================================================================================================================================================================================
 Package                                                    Architecture                           Version                                               Repository                              Size
======================================================================================================================================================================================================
Removing:
 kernel-numa64-core                                         aarch64                                4.18.0-147.5.1.es8_24                                 @System                                 54 M
Removing dependent packages:
 kernel-numa64                                              aarch64                                4.18.0-147.5.1.es8_24                                 @System                                  0
 kernel-numa64-modules                                      aarch64                                4.18.0-147.5.1.es8_24                                 @System                                7.4 M
 kernel-numa64-modules-extra                                aarch64                                4.18.0-147.5.1.es8_24                                 @System                                404 k

Transaction Summary
======================================================================================================================================================================================================
Remove  4 Packages

Freed space: 62 M
Running transaction check
Transaction check succeeded.
Running transaction test
Transaction test succeeded.
Running transaction
  Preparing        :                                                                                                                                                                              1/1
  Erasing          : kernel-numa64-4.18.0-147.5.1.es8_24.aarch64                                                                                                                                  1/4
  Erasing          : kernel-numa64-modules-extra-4.18.0-147.5.1.es8_24.aarch64                                                                                                                    2/4
  Running scriptlet: kernel-numa64-modules-extra-4.18.0-147.5.1.es8_24.aarch64                                                                                                                    2/4
  Erasing          : kernel-numa64-modules-4.18.0-147.5.1.es8_24.aarch64                                                                                                                          3/4
  Running scriptlet: kernel-numa64-modules-4.18.0-147.5.1.es8_24.aarch64                                                                                                                          3/4
  Running scriptlet: kernel-numa64-core-4.18.0-147.5.1.es8_24.aarch64                                                                                                                             4/4
  Erasing          : kernel-numa64-core-4.18.0-147.5.1.es8_24.aarch64                                                                                                                             4/4
  Running scriptlet: kernel-numa64-core-4.18.0-147.5.1.es8_24.aarch64                                                                                                                             4/4
  Verifying        : kernel-numa64-4.18.0-147.5.1.es8_24.aarch64                                                                                                                                  1/4
  Verifying        : kernel-numa64-core-4.18.0-147.5.1.es8_24.aarch64                                                                                                                             2/4
  Verifying        : kernel-numa64-modules-4.18.0-147.5.1.es8_24.aarch64                                                                                                                          3/4
  Verifying        : kernel-numa64-modules-extra-4.18.0-147.5.1.es8_24.aarch64                                                                                                                    4/4

Removed:
  kernel-numa64-4.18.0-147.5.1.es8_24.aarch64                           kernel-numa64-core-4.18.0-147.5.1.es8_24.aarch64             kernel-numa64-modules-4.18.0-147.5.1.es8_24.aarch64
  kernel-numa64-modules-extra-4.18.0-147.5.1.es8_24.aarch64

Complete!
remove rpm pkg kernel-numa64-core-4.18.0-147.5.1.es8_24.aarch64 success
```

## 601升级611
由于无法构建出环境, 只是手动创建vmlinuz 和initramfs
环境信息:
```
[root@localhost boot]# ls /boot/vmlinuz-* |grep -v rescue
/boot/vmlinuz-4.18.0-147.5.1.el8_1.5es.20.numa64
/boot/vmlinuz-4.18.0-147.5.1.es8_24.aarch64+numa64
```

执行脚本:
```
[root@localhost boot]# sh /root/remove_kernel.sh
delete kdump initrd
the number of kernel is 2, need remove to keep number to 1
remove kernel 4.18.0-147.5.1.el8_1.5es.20.numa64
direct remove kernel 4.18.0-147.5.1.el8_1.5es.20.numa64 to /root/escloud_image_backup/4.18.0-147.5.1.el8_1.5es.20.numa64
[root@localhost boot]# ls /root/escloud_image_backup/4.18.0-147.5.1.el8_1.5es.20.numa64/
initramfs-4.18.0-147.5.1.el8_1.5es.20.numa64.img  vmlinuz-4.18.0-147.5.1.el8_1.5es.20.numa64
```

## 601 before ??

> NOTE
>
> 无更早版本
