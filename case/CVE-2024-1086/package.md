# kmod 方式
## 621
x86_64: http://koji.easystack.io/kojifiles/packages/kmod-nf_tables-kmodtool/4.18.0.372/0.es8_0.k372/x86_64/kmod-nf_tables-4.18.0.372-0.es8_0.k372.x86_64.rpm
arm64:  http://koji.easystack.io/kojifiles/packages/kmod-nf_tables-kmodtool/4.18.0.372/0.es8_0.k372/aarch64/kmod-nf_tables-4.18.0.372-0.es8_0.k372.aarch64.rpm

## 611
x86_64: http://koji.easystack.io/kojifiles/packages/kmod-nf_tables-kmodtool/4.18.0.147/0.es8_0.k147/x86_64/kmod-nf_tables-4.18.0.147-0.es8_0.k147.x86_64.rpm
arm64: http://koji.easystack.io/kojifiles/packages/kmod-nf_tables-kmodtool/4.18.0.147/0.es8_0.k147/aarch64/kmod-nf_tables-4.18.0.147-0.es8_0.k147.aarch64.rpm

## 602
x86_64: http://koji.easystack.io/kojifiles/packages/kmod-nf_tables-kmodtool/4.18.0.147/0.es7_0.k147/x86_64/kmod-nf_tables-4.18.0.147-0.es7_0.k147.x86_64.rpm
arm64: http://koji.easystack.io/kojifiles/packages/kmod-nf_tables-kmodtool/4.18.0.147/0.es7_0.k147/aarch64/kmod-nf_tables-4.18.0.147-0.es7_0.k147.aarch64.rpm 

## 变更方法
yum install + ${RPM包}
执行网络组的模块卸载,加载脚本

## 回退方法
yum remove + ${RPM包}
执行网络组的模块卸载,加载脚本


# kernel package

## 621 kernel package

x86_64:

http://koji.easystack.io/kojifiles/packages/kernel/4.18.0/372.19.1.es8_11/x86_64/kernel-4.18.0-372.19.1.es8_11.x86_64.rpm
http://koji.easystack.io/kojifiles/packages/kernel/4.18.0/372.19.1.es8_11/x86_64/kernel-core-4.18.0-372.19.1.es8_11.x86_64.rpm
http://koji.easystack.io/kojifiles/packages/kernel/4.18.0/372.19.1.es8_11/x86_64/kernel-modules-4.18.0-372.19.1.es8_11.x86_64.rpm
http://koji.easystack.io/kojifiles/packages/kernel/4.18.0/372.19.1.es8_11/x86_64/kernel-modules-extra-4.18.0-372.19.1.es8_11.x86_64.rpm


arm64:

http://koji.easystack.io/kojifiles/packages/kernel/4.18.0/372.19.1.es8_11/aarch64/kernel-4.18.0-372.19.1.es8_11.aarch64.rpm
http://koji.easystack.io/kojifiles/packages/kernel/4.18.0/372.19.1.es8_11/aarch64/kernel-core-4.18.0-372.19.1.es8_11.aarch64.rpm
http://koji.easystack.io/kojifiles/packages/kernel/4.18.0/372.19.1.es8_11/aarch64/kernel-modules-4.18.0-372.19.1.es8_11.aarch64.rpm
http://koji.easystack.io/kojifiles/packages/kernel/4.18.0/372.19.1.es8_11/aarch64/kernel-modules-extra-4.18.0-372.19.1.es8_11.aarch64.rpm


## 611 kernel package

x86_64:

http://koji.easystack.io/kojifiles/packages/kernel/4.18.0/147.5.1.es8_28/x86_64/kernel-4.18.0-147.5.1.es8_28.x86_64.rpm
http://koji.easystack.io/kojifiles/packages/kernel/4.18.0/147.5.1.es8_28/x86_64/kernel-core-4.18.0-147.5.1.es8_28.x86_64.rpm
http://koji.easystack.io/kojifiles/packages/kernel/4.18.0/147.5.1.es8_28/x86_64/kernel-modules-4.18.0-147.5.1.es8_28.x86_64.rpm
http://koji.easystack.io/kojifiles/packages/kernel/4.18.0/147.5.1.es8_28/x86_64/kernel-modules-extra-4.18.0-147.5.1.es8_28.x86_64.rpm

arm64:

http://koji.easystack.io/kojifiles/packages/kernel/4.18.0/147.5.1.es8_28/aarch64/kernel-4.18.0-147.5.1.es8_28.aarch64.rpm
http://koji.easystack.io/kojifiles/packages/kernel/4.18.0/147.5.1.es8_28/aarch64/kernel-core-4.18.0-147.5.1.es8_28.aarch64.rpm
http://koji.easystack.io/kojifiles/packages/kernel/4.18.0/147.5.1.es8_28/aarch64/kernel-modules-4.18.0-147.5.1.es8_28.aarch64.rpm
http://koji.easystack.io/kojifiles/packages/kernel/4.18.0/147.5.1.es8_28/aarch64/kernel-modules-extra-4.18.0-147.5.1.es8_28.aarch64.rpm

## 602 / 601 kernel package
x86_64:

http://koji.easystack.io/kojifiles/packages/kernel/4.18.0/147.5.1.es7_28/x86_64/kernel-4.18.0-147.5.1.es7_28.x86_64.rpm
http://koji.easystack.io/kojifiles/packages/kernel/4.18.0/147.5.1.es7_28/x86_64/kernel-core-4.18.0-147.5.1.es7_28.x86_64.rpm
http://koji.easystack.io/kojifiles/packages/kernel/4.18.0/147.5.1.es7_28/x86_64/kernel-modules-4.18.0-147.5.1.es7_28.x86_64.rpm
http://koji.easystack.io/kojifiles/packages/kernel/4.18.0/147.5.1.es7_28/x86_64/kernel-modules-extra-4.18.0-147.5.1.es7_28.x86_64.rpm

arm64:

http://koji.easystack.io/kojifiles/packages/kernel/4.18.0/147.5.1.es7_28/aarch64/kernel-4.18.0-147.5.1.es7_28.aarch64.rpm
http://koji.easystack.io/kojifiles/packages/kernel/4.18.0/147.5.1.es7_28/aarch64/kernel-core-4.18.0-147.5.1.es7_28.aarch64.rpm
http://koji.easystack.io/kojifiles/packages/kernel/4.18.0/147.5.1.es7_28/aarch64/kernel-modules-4.18.0-147.5.1.es7_28.aarch64.rpm
http://koji.easystack.io/kojifiles/packages/kernel/4.18.0/147.5.1.es7_28/aarch64/kernel-modules-extra-4.18.0-147.5.1.es7_28.aarch64.rpm

## 升级步骤

1. 首先注意boot分区空间, 如果空间不足需要清理/boot分区
2. rpm -ivh  + ${上面的所有rpm包} --oldpackage
3. reboot

> NOTE
>
> 目前发布产品的 /boot分区空间有200M+ 和1G.
>
> 如果boot空间不足, 需要 yum remove 之前的kernel-core rpm, 
> 保证目前环境中只有一套kernel package.
>
> 但是需要注意的是, 在611 yum remove 之前版本的kernel-core
> 会出现错误. (这种情况一般出现在升级611的环境), 最好联系系统
> 组, 去环境看下. 出定制的变更方法.

# 关闭 user namespace 脚本

## 变更脚本
```
if [[ ! -e /etc/sysctl.d/userns.conf ]];then
        cp /proc/sys/user/max_user_namespaces /etc/sysctl.d/userns.conf
        sed -i '1s/^/###\ /' /etc/sysctl.d/userns.conf
        echo "user.max_user_namespaces=0" >> /etc/sysctl.d/userns.conf
        sysctl -p /etc/sysctl.d/userns.conf
fi
```

## 变更成功验证
1. cat /proc/sys/user/max_user_namespaces 
   输出为0
2. cat /etc/sysctl.d/userns.conf
   ```
   ### xxxxx
   user.max_user_namespaces=0
   ```

## 回退脚本
```
if [ -e  /etc/sysctl.d/userns.conf ];then
        ORG_NUM=`cat /etc/sysctl.d/userns.conf |head -1|cut -d ' ' -f2`
        echo $ORG_NUM > /proc/sys/user/max_user_namespaces
        rm -f /etc/sysctl.d/userns.conf
fi
```

## 回退成功验证
1. cat /proc/sys/user/max_user_namespaces 
   输出不为0
2. 没有 /etc/sysctl.d/userns.conf 文件
   

